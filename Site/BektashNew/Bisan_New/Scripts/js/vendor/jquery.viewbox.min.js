!function(e){e.fn.viewbox=function(t){void 0===t&&(t={}),t=e.extend({template:'<div class="viewbox-container"><div class="viewbox-body"><div class="viewbox-header"></div><div class="viewbox-content"></div><div class="viewbox-footer"></div></div></div>',loader:'<div class="loader"><div class="spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>',setTitle:!0,margin:20,resizeDuration:400,openDuration:200,closeDuration:200,closeButton:!0,navButtons:!0,closeOnSideClick:!0,nextOnContentClick:!1,useGestures:!0},t);var n,i,o,a,r,c=e(this),l=e(t.template),s=e(t.loader),d=!1,h=!1,v=[];function g(i){if(!h){!function(){var e;for(;v.length;)(e=v.shift()).placeholder.before(e.content),e.placeholder.detach()}();var o=i.attr("href"),a=t.setTitle&&i.attr("title")?i.attr("title"):"";o?function(e){return e.match(/(png|jpg|jpeg|gif)(\?.*)?$/i)}(o)?(n=i,function(n,i){var o=e('<img class="viewbox-image" alt="">').attr("src",n);p(o)||x(!0);b("content",""),b("header",i),u();var a=w("body"),r=0,c=w("content"),l=w("header"),s=window.setInterval(function(){if(!p(o)&&r<1e3)r++;else{window.clearInterval(s),x(!1),e("body").append(o),l.hide();var n=a.width()-c.width()+2*t.margin,i=a.height()-c.height()+2*t.margin,d=e(window).width()-n,v=e(window).height()-i,g=o.width(),u=o.height();o.detach(),g>d&&(u=u*d/g,g=d),u>v&&(g=g*v/u,u=v),h=!0,a.animate({"margin-left":-(g+n)/2+t.margin,"margin-top":-(u+i)/2+t.margin},t.resizeDuration),c.animate({width:g,height:u},t.resizeDuration,function(){c.append(o),l.show().width(g),h=!1})}},p(o)?0:200)}(o,a)):function(t){return t.match(/^#.+$/i)&&e(t).length}(o)&&(n=i,y(o,a)):(n=i,y(i,a))}}function u(n,i){var o,a,r=w("body"),c=w("content"),s=w("header");n&&(c.width(n),s.width(n)),i&&c.height(i),d?(o=r.width(),a=r.height()):(d=!0,e("body").append(l),l.show(),o=r.width(),a=r.height(),l.hide(),l.fadeIn(t.openDuration)),r.css({"margin-left":-o/2,"margin-top":-a/2})}function w(e){return l.find(".viewbox-"+e)}function b(e,t){w(e).html(t)}function f(){var e=-1;return n&&c.each(function(t){if(n.is(this))return e=t,!1}),e}function p(e){return e.get(0).complete}function x(e){e?s.appendTo(w("body")):s.detach()}function m(t){var n=e('<div class="viewbox-button-default viewbox-button-'+t+'"></div>'),i=window.location.pathname+window.location.search+"#viewbox-"+t+"-icon";return n.appendTo(l).get(0).insertAdjacentHTML("afterbegin",'<svg><use xlink:href="'+i+'"/></svg>'),n}function y(t,n){var i=e(t),o=e('<div class="viewbox-content-placeholder"></div>');i.before(o),d&&l.trigger("viewbox.close"),b("content",""),b("header",n),w("content").append(i),u("auto","auto"),v.push({placeholder:o,content:i})}return e("#viewbox-sprite").length||e("body").get(0).insertAdjacentHTML("afterbegin",'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="viewbox-sprite" style="display:none"><symbol id="viewbox-close-icon" viewBox="0 0 50 50"><path d="M37.304 11.282l1.414 1.414-26.022 26.02-1.414-1.413z"/><path d="M12.696 11.282l26.022 26.02-1.414 1.415-26.022-26.02z"/></symbol><symbol id="viewbox-prev-icon" viewBox="0 0 50 50"><path d="M27.3 34.7L17.6 25l9.7-9.7 1.4 1.4-8.3 8.3 8.3 8.3z"/></symbol><symbol id="viewbox-next-icon" viewBox="0 0 50 50"><path d="M22.7 34.7l-1.4-1.4 8.3-8.3-8.3-8.3 1.4-1.4 9.7 9.7z"/></symbol></svg>'),l.bind("viewbox.open",function(t,n){Number.isInteger(n)&&c.length?g(c.eq(n>=0&&n<c.length?n:0)):n&&n.tagName?g(e(n)):c.length&&g(c.eq(0))}),l.bind("viewbox.next",function(e){if(!(c.length<=1)){var t=f()+1;t>=c.length&&(t=0),g(c.eq(t))}}),l.bind("viewbox.prev",function(e){if(!(c.length<=1)){var t=f()-1;t<0&&(t=c.length-1),g(c.eq(t))}}),l.bind("viewbox.close",function(e){d&&l.fadeOut(t.closeDuration,function(){d=!1})}),c.filter("a").click(function(){return l.trigger("viewbox.open",[this]),!1}),w("body").click(function(e){e.stopPropagation(),t.nextOnContentClick&&l.trigger("viewbox.next")}),t.closeButton&&m("close").click(function(e){e.stopPropagation(),l.trigger("viewbox.close")}),t.navButtons&&c.length>1&&(m("next").click(function(e){e.stopPropagation(),l.trigger("viewbox.next")}),m("prev").click(function(e){e.stopPropagation(),l.trigger("viewbox.prev")})),t.closeOnSideClick&&l.click(function(){l.trigger("viewbox.close")}),t.useGestures&&"ontouchstart"in document.documentElement&&(i=l,"function"==typeof(o=function(e){switch(e){case"left":l.trigger("viewbox.next");break;case"right":l.trigger("viewbox.prev")}})&&(i.on("touchstart",function(e){var t=e.originalEvent.changedTouches[0];a={x:t.pageX,y:t.pageY},r=(new Date).getTime()}),i.on("touchend",function(e){var t=e.originalEvent.changedTouches[0],n="none",i=(new Date).getTime()-r,c=t.pageX,l=t.pageY,s={x:c-a.x,y:l-a.y};i<=300&&(Math.abs(s.x)>=150&&Math.abs(s.y)<=100?n=s.x<0?"left":"right":Math.abs(s.y)>=150&&Math.abs(s.x)<=100&&(n=s.y<0?"up":"down")),o.call(this,n)}))),l}}(jQuery);